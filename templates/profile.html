{% extends "base.html" %}

{% block title %}Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø± - {{ settings.system_name }}{% endblock %}

{% block content %}
<style>
/* ÙÙˆÙ†Øª Ù†Ø§Ø²Ù†ÛŒÙ† */
@font-face {
    font-family: 'Nazanin';
    src: url('{{ url_for("static", filename="fonts/B-NAZANIN.TTF") }}') format('truetype');
    font-weight: normal;
    font-style: normal;
}

body {
    font-family: 'Nazanin', 'B Nazanin', 'BNazanin', Tahoma, sans-serif !important;
}

.avatar-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #28a745;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
}
.avatar-container {
    position: relative;
    display: inline-block;
}
.avatar-actions {
    margin-top: 15px;
    margin-bottom: 15px;
}

/* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ */
.compact-card {
    margin-bottom: 0.8rem;
    height: 100%;
}
.compact-card .card-body {
    padding: 0.7rem;
    display: flex;
    flex-direction: column;
    height: 100%;
}
.compact-card .card-title {
    font-size: 0.9rem; /* Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª */
    margin-bottom: 0.4rem;
    font-weight: bold;
}
.compact-card .row {
    margin-bottom: -0.3rem;
}
.compact-card .mb-2 {
    margin-bottom: 0.3rem !important;
}
.compact-card small {
    font-size: 0.8rem; /* Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª */
}
.compact-card .fw-bold {
    font-size: 0.9rem; /* Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª */
}
.compact-card .badge {
    font-size: 0.8rem; /* Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª */
    padding: 0.25rem 0.5rem;
}

/* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø¢ÙˆØ§ØªØ§Ø± */
.avatar-section {
    padding: 0.5rem 0;
}
.avatar-section h4 {
    font-size: 1.1rem;
    margin-bottom: 0.2rem;
}
.avatar-section .text-muted {
    font-size: 0.8rem;
}

/* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
.compact-buttons .btn {
    padding: 0.4rem 0.8rem;
    font-size: 0.9rem; /* Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª */
}
.compact-buttons .btn i {
    font-size: 0.9rem; /* Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª */
}

/* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ */
.compact-alert {
    padding: 0.6rem 0.8rem;
    margin-bottom: 0;
}
.compact-alert small {
    font-size: 0.8rem; /* Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª */
    line-height: 1.4;
}

/* Ø¨Ù‡Ø¨ÙˆØ¯ Ú†ÛŒØ¯Ù…Ø§Ù† Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
.cards-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}
.card-spacer {
    flex: 1;
    min-height: 10px;
}
</style>

<div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">  <!-- ØªØºÛŒÛŒØ± Ø§ØµÙ„ÛŒ Ø§ÛŒÙ†Ø¬Ø§ -->
        <div class="card">
            <div class="card-header text-center py-2">
                <h5 class="mb-0" style="font-size: 1.1rem;">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±</h5>
            </div>
            <div class="card-body py-3">
                <!-- Ø¢ÙˆØ§ØªØ§Ø± Ú©Ø§Ø±Ø¨Ø± -->
                <div class="text-center avatar-section">
                    <div class="avatar-container">
                        {% if user_info.avatar %}
                        <img src="{{ url_for('static', filename=user_info.avatar) if user_info.avatar.startswith('uploads/') else user_info.avatar }}" 
                             alt="Ø¢ÙˆØ§ØªØ§Ø±" 
                             class="rounded-circle border {% if user_info.has_custom_avatar %}border-success{% else %}border-primary{% endif %}" 
                             width="100" 
                             height="100" 
                             style="object-fit: cover;">
                        
                        <!-- Ù†Ø´Ø§Ù†Ú¯Ø± Ù…Ù†Ø¨Ø¹ Ø¢ÙˆØ§ØªØ§Ø± -->
                        <div class="avatar-badge">
                            <i class="bi bi-check-lg" title="Ø¢ÙˆØ§ØªØ§Ø± Ø´Ø®ØµÛŒ"></i>
                        </div>
                        {% else %}
                        <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center border" 
                             style="width: 100px; height: 100px;">
                            <i class="bi bi-person-fill text-white" style="font-size: 2.5rem;"></i>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Ø¯Ú©Ù…Ù‡ ØªØºÛŒÛŒØ± Ø¢ÙˆØ§ØªØ§Ø± -->
                    <div class="avatar-actions">
                        <form action="/user/upload_avatar" method="post" enctype="multipart/form-data" class="d-inline">
                            <input type="file" 
                                   class="form-control" 
                                   name="avatar" 
                                   id="avatarInput" 
                                   accept="image/*" 
                                   style="display: none;"
                                   onchange="this.form.submit()">
                            <label for="avatarInput" class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-camera"></i>
                                ØªØºÛŒÛŒØ± Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
                            </label>
                        </form>
                    </div>
                </div>

                <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± -->
                <div class="row g-2 align-items-stretch">
                    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ -->
                    <div class="col-12">
                        <div class="card bg-light compact-card">
                            <div class="card-body">
                                <h6 class="card-title border-bottom pb-1">ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ</h6>
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <small class="text-muted">Ù†Ø§Ù… Ú©Ø§Ù…Ù„:</small>
                                        <div class="fw-bold">{{ user_info.name }}</div>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <small class="text-muted">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</small>
                                        <div class="fw-bold">{{ user_info.username }}</div>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <small class="text-muted">Ø§ÛŒÙ…ÛŒÙ„:</small>
                                        <div class="fw-bold">{{ user_info.email }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÙØ¹Ø§Ù„ÛŒØª Ùˆ Ø¢Ù…Ø§Ø± Ùˆ Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø± ÛŒÚ© Ø±Ø¯ÛŒÙ -->
                    <div class="col-md-6">
                        <div class="card bg-light compact-card h-100">
                            <div class="card-body">
                                <h6 class="card-title border-bottom pb-1">ğŸ“Š ÙØ¹Ø§Ù„ÛŒØª Ùˆ Ø¢Ù…Ø§Ø±</h6>
                                <div class="mb-2">
                                    <small class="text-muted">Ø§ÙˆÙ„ÛŒÙ† ÙˆØ±ÙˆØ¯:</small>
                                    <div class="fw-bold">{{ user_info.first_login }}</div>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted">ÙˆØ¶Ø¹ÛŒØª Ø­Ø³Ø§Ø¨:</small>
                                    <div>
                                        {% if user_info.status == 'active' %}
                                        <span class="badge bg-success">ÙØ¹Ø§Ù„</span>
                                        {% elif user_info.status == 'locked' %}
                                        <span class="badge bg-danger">Ù‚ÙÙ„ Ø´Ø¯Ù‡</span>
                                        {% elif user_info.status == 'invited' %}
                                        <span class="badge bg-warning text-dark">Ø¯Ø¹ÙˆØª Ø´Ø¯Ù‡</span>
                                        {% elif user_info.status == 'registered' %}
                                        <span class="badge bg-info">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ø¯Ù‡</span>
                                        {% else %}
                                        <span class="badge bg-secondary">{{ user_info.status }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ -->
                    <div class="col-md-6">
                        <div class="card bg-light compact-card h-100">
                            <div class="card-body">
                                <h6 class="card-title border-bottom pb-1">ğŸ” Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ</h6>
                                <div class="mb-2">
                                    <small class="text-muted">Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ:</small>
                                    <div>
                                        {% if user_info.is_admin %}
                                        <span class="badge bg-success">Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</span>
                                        {% else %}
                                        <span class="badge bg-secondary">Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <!-- ÙØ¶Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ù…â€ŒØªØ±Ø§Ø²ÛŒ Ø§Ø±ØªÙØ§Ø¹ -->
                                <div class="mt-auto"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ -->
                    <div class="col-12">
                        <div class="card bg-light compact-card">
                            <div class="card-body">
                                <h6 class="card-title border-bottom pb-1">ğŸ¢ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ</h6>
                                <div class="row">
                                    {% if user_info.department and user_info.department != 'ÙÙ†Ø§ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª' %}
                                    <div class="col-md-6 mb-2">
                                        <small class="text-muted">Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù†:</small>
                                        <div class="fw-bold">{{ user_info.department }}</div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if user_info.user_role_custom and user_info.user_role_custom != 'user' %}
                                    <div class="col-md-6 mb-2">
                                        <small class="text-muted">Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±ÛŒ:</small>
                                        <div class="fw-bold">{{ user_info.user_role_custom }}</div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if user_info.team %}
                                    <div class="col-md-6 mb-2">
                                        <small class="text-muted">ØªÛŒÙ…:</small>
                                        <div class="fw-bold">{{ user_info.team }}</div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if user_info.position and user_info.position != 'Ø¹Ø¶Ùˆ' %}
                                    <div class="col-md-6 mb-2">
                                        <small class="text-muted">Ø³Ù…Øª:</small>
                                        <div class="fw-bold">{{ user_info.position }}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù‚Ø¯Ø§Ù… - Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ -->
                <div class="row mt-3 compact-buttons">
                    <div class="col-md-4 mb-2">
                        <a href="/user/refresh_profile" class="btn btn-outline-primary w-100">
                            <i class="bi bi-arrow-repeat"></i>
                            Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
                        </a>
                    </div>
                    <div class="col-md-4 mb-2">
                        <a href="/dashboard" class="btn btn-outline-secondary w-100">
                            <i class="bi bi-speedometer2"></i>
                            Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                        </a>
                    </div>
                    <div class="col-md-4 mb-2">
                        <a href="/logout" class="btn btn-outline-danger w-100">
                            <i class="bi bi-box-arrow-left"></i>
                            Ø®Ø±ÙˆØ¬
                        </a>
                    </div>
                </div>

                <!-- Ù†Ú©Ø§Øª Ø±Ø§Ù‡Ù†Ù…Ø§ -->
                <div class="alert alert-info mt-3 compact-alert">
                    <i class="bi bi-info-circle"></i>
                    <small>
                        â€¢ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ú©Ø§Ø±Ø¨Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒØ´ÙˆØ¯<br>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¹Ú©Ø³ Ù‚Ø¨Ù„ Ø§Ø² Ø¢Ù¾Ù„ÙˆØ¯
document.getElementById('avatarInput')?.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        // Ø¨Ø±Ø±Ø³ÛŒ Ø­Ø¬Ù… ÙØ§ÛŒÙ„ (Ø­Ø¯Ø§Ú©Ø«Ø± 2MB)
        if (file.size > 2 * 1024 * 1024) {
            alert('Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ú©Ù…ØªØ± Ø§Ø² 2 Ù…Ú¯Ø§Ø¨Ø§ÛŒØª Ø¨Ø§Ø´Ø¯.');
            this.value = '';
            return;
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„
        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
        if (!allowedTypes.includes(file.type)) {
            alert('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙØ§ÛŒÙ„ ØªØµÙˆÛŒØ±ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ (JPEG, PNG, GIF)');
            this.value = '';
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯
            const uploadMessage = document.createElement('div');
            uploadMessage.className = 'alert alert-info mt-2';
            uploadMessage.innerHTML = '<i class="bi bi-arrow-up-circle"></i> Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±...';
            
            const avatarContainer = document.querySelector('.avatar-container');
            avatarContainer.parentNode.insertBefore(uploadMessage, avatarContainer.nextSibling);
        }
        reader.readAsDataURL(file);
    }
});
</script>

<style>
/* responsive adjustments */
@media (max-width: 768px) {
    .compact-buttons .btn {
        font-size: 0.8rem;
        padding: 0.35rem 0.6rem;
    }
    
    .avatar-section h4 {
        font-size: 1rem;
    }
    
    .compact-card .card-body {
        padding: 0.6rem;
    }
}

/* Ø¨Ù‡Ø¨ÙˆØ¯ ÙÙˆÙ†Øª Ø¨Ø±Ø§ÛŒ Ú©Ù„ Ø³ÛŒØ³ØªÙ… */
.card-header h5,
.card-title,
.fw-bold,
.btn,
.alert,
small {
    font-family: 'Nazanin', 'B Nazanin', 'BNazanin', Tahoma, sans-serif !important;
}

/* Ø§ÙØ²Ø§ÛŒØ´ Ú©Ù„ÛŒ Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª */
body {
    font-size: 0.95rem;
}
</style>
{% endblock %}
{% extends "base.html" %}

{% block title %}ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ… - {{ settings.system_name }}{% endblock %}

{% block content %}
<style>
.compact-form .form-label {
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 0.3rem;
}
.compact-form .form-control, .compact-form .form-select {
    font-size: 0.8rem;
    padding: 0.3rem 0.5rem;
    height: calc(1.8em + 0.6rem);
}
.compact-form .form-text {
    font-size: 0.75rem;
}
.compact-form .card {
    margin-bottom: 0.5rem;
}
.compact-form .card-header {
    padding: 0.6rem 1rem;
    font-size: 0.9rem;
}
.compact-form .card-body {
    padding: 0.8rem;
}
.compact-form .row {
    margin-bottom: 0.8rem;
}
.compact-form .input-group {
    margin-bottom: 0.3rem;
}
.compact-form .feature-icon-select {
    max-width: 70px;
    font-size: 0.8rem;
}
.small-preview {
    transform: scale(0.85);
    transform-origin: top right;
}
.column-settings-table th, .column-settings-table td {
    font-size: 0.8rem;
    padding: 0.4rem 0.5rem;
}
</style>

<div class="row">
    <div class="col-12">
        <div class="card compact-form">
            <div class="card-header d-flex justify-content-between align-items-center py-2">
                <h6 class="mb-0">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…</h6>
                <div>
                    <button type="submit" form="settingsForm" class="btn btn-primary btn-sm">
                        <i class="bi bi-check-circle"></i> Ø°Ø®ÛŒØ±Ù‡
                    </button>
                    <a href="/dashboard" class="btn btn-secondary btn-sm">
                        <i class="bi bi-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª
                    </a>
                </div>
            </div>
            <div class="card-body">
                <form id="settingsForm" method="POST" action="/admin/save_settings" enctype="multipart/form-data">
                    
                    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ Ø¯Ø± ÛŒÚ© Ø±Ø¯ÛŒÙ -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Ù†Ø§Ù… Ø³ÛŒØ³ØªÙ…</label>
                            <input type="text" name="system_name" class="form-control" value="{{ settings.system_name }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Ù„ÙˆÚ¯Ùˆ Ø³ÛŒØ³ØªÙ…</label>
                            <input type="file" name="logo" class="form-control" accept="image/*">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</label>
                            <input type="file" name="background" class="form-control" accept="image/*">
                        </div>
                    </div>

                    <!-- Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ -->
                    {% if settings.logo_path or settings.background_path %}
                    <div class="row g-2 mb-3">
                        {% if settings.logo_path %}
                        <div class="col-md-6">
                            <small class="text-muted">Ù„ÙˆÚ¯Ùˆ ÙØ¹Ù„ÛŒ:</small>
                            <img src="{{ url_for('static', filename=settings.logo_path) }}" alt="Ù„ÙˆÚ¯Ùˆ" width="40" class="border rounded p-1 d-block">
                        </div>
                        {% endif %}
                        {% if settings.background_path %}
                        <div class="col-md-6">
                            <small class="text-muted">Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ ÙØ¹Ù„ÛŒ:</small>
                            <img src="{{ url_for('static', filename=settings.background_path) }}" alt="Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡" width="60" class="border rounded p-1 d-block">
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ù†Ú¯â€ŒÙ‡Ø§ -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Ø±Ù†Ú¯ Ù‡Ø¯Ø±</label>
                            <input type="color" name="header_color" class="form-control form-control-color" value="{{ settings.header_color }}" id="headerColor">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Ø±Ù†Ú¯ Ù…ØªÙ† Ù‡Ø¯Ø±</label>
                            <input type="color" name="header_text_color" class="form-control form-control-color" value="{{ settings.header_text_color }}" id="headerTextColor">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</label>
                            <input type="color" name="background_color" class="form-control form-control-color" value="{{ settings.background_color }}" id="backgroundColor">
                        </div>
                    </div>

                    <!-- Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø±Ù†Ú¯â€ŒÙ‡Ø§ -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <label class="form-label">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø±Ù†Ú¯â€ŒÙ‡Ø§:</label>
                            <div class="p-2 border rounded small-preview" id="backgroundPreview" style="background-color: {{ settings.background_color }};">
                                <div class="p-2 rounded mb-1 d-flex align-items-center" id="headerPreview" style="background-color: {{ settings.header_color }}; color: {{ settings.header_text_color }};">
                                    {% if settings.logo_path %}
                                    <img src="{{ url_for('static', filename=settings.logo_path) }}" alt="Logo" width="20" height="20" class="rounded-circle me-1">
                                    {% else %}
                                    <i class="bi bi-building me-1"></i>
                                    {% endif %}
                                    <span style="font-size: 0.8rem;">{{ settings.system_name }}</span>
                                </div>
                                <div class="p-1">
                                    <small class="text-muted" style="font-size: 0.7rem;">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¸Ø§Ù‡Ø± Ø³ÛŒØ³ØªÙ…</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ú©Ù…Ù‡ ÙˆØ±ÙˆØ¯ -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-8">
                            <label class="form-label">Ù…ØªÙ† Ø¯Ú©Ù…Ù‡ ÙˆØ±ÙˆØ¯</label>
                            <input type="text" name="login_button_text" class="form-control" value="{{ settings.login_button_text }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Ø¢ÛŒÚ©ÙˆÙ† Ø¯Ú©Ù…Ù‡</label>
                            <select name="login_button_icon" class="form-select">
                                <option value="bi-box-arrow-in-right" {% if settings.login_button_icon == 'bi-box-arrow-in-right' %}selected{% endif %}>ğŸ“¤ ÙˆØ±ÙˆØ¯</option>
                                <option value="bi-key" {% if settings.login_button_icon == 'bi-key' %}selected{% endif %}>ğŸ”‘ Ú©Ù„ÛŒØ¯</option>
                                <option value="bi-lock" {% if settings.login_button_icon == 'bi-lock' %}selected{% endif %}>ğŸ”’ Ù‚ÙÙ„</option>
                                <option value="bi-person" {% if settings.login_button_icon == 'bi-person' %}selected{% endif %}>ğŸ‘¤ Ø´Ø®Øµ</option>
                            </select>
                        </div>
                    </div>

                    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±Ù… -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-3">
                            <label class="form-label">Ø¹Ø±Ø¶ ÙØ±Ù… (px)</label>
                            <input type="number" name="login_width" class="form-control" value="{{ settings.login_width }}" min="300" max="500">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Ø§Ø±ØªÙØ§Ø¹ ÙØ±Ù…</label>
                            <input type="text" name="login_height" class="form-control" value="{{ settings.login_height }}" placeholder="auto">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§ÙÙ‚ÛŒ (%)</label>
                            <input type="number" name="login_position_x" class="form-control" value="{{ settings.login_position_x }}" min="0" max="100">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¹Ù…ÙˆØ¯ÛŒ (%)</label>
                            <input type="number" name="login_position_y" class="form-control" value="{{ settings.login_position_y }}" min="0" max="100">
                        </div>
                    </div>

                    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Ø­Ø¯Ø§Ú©Ø«Ø± ØªÙ„Ø§Ø´ Ù„Ø§Ú¯ÛŒÙ†</label>
                            <input type="number" name="max_login_attempts" class="form-control" value="{{ settings.max_login_attempts }}" min="1" max="10">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Ø²Ù…Ø§Ù† Ù‚ÙÙ„ (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                            <input type="number" name="lockout_time" class="form-control" value="{{ settings.lockout_time }}" min="1" max="240">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Session Timeout (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                            <input type="number" name="session_timeout" class="form-control" value="{{ settings.session_timeout|default('30') }}" min="1" max="480">
                            <small class="form-text">Ø²Ù…Ø§Ù† Ø¹Ø¯Ù… ÙØ¹Ø§Ù„ÛŒØª Ù‚Ø¨Ù„ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø®ÙˆØ¯Ú©Ø§Ø±</small>
                        </div>
                    </div>

                    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Ø²Ù…Ø§Ù† Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… (Ø«Ø§Ù†ÛŒÙ‡)</label>
                            <input type="number" name="flash_timeout" class="form-control" value="{{ settings.flash_timeout }}" min="1" max="10">
                        </div>
                        <div class="col-md-8">
                            <label class="form-label">Ù…ØªÙ† Ú©Ù¾ÛŒ Ø±Ø§ÛŒØª</label>
                            <input type="text" name="copyright_text" class="form-control" value="{{ settings.copyright_text }}">
                        </div>
                    </div>

                    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-4">
                            <label class="form-label">ÙˆÛŒÚ˜Ú¯ÛŒ Û±</label>
                            <div class="input-group">
                                <input type="text" name="login_text_1" class="form-control" value="{{ settings.login_text_1 }}" placeholder="Ù…ØªÙ† ÙˆÛŒÚ˜Ú¯ÛŒ">
                                <select name="login_icon_1" class="form-select feature-icon-select">
                                    <option value="ğŸ”" {% if settings.login_icon_1 == 'ğŸ”' %}selected{% endif %}>ğŸ”</option>
                                    <option value="ğŸ“Š" {% if settings.login_icon_1 == 'ğŸ“Š' %}selected{% endif %}>ğŸ“Š</option>
                                    <option value="ğŸ“ˆ" {% if settings.login_icon_1 == 'ğŸ“ˆ' %}selected{% endif %}>ğŸ“ˆ</option>
                                    <option value="ğŸš€" {% if settings.login_icon_1 == 'ğŸš€' %}selected{% endif %}>ğŸš€</option>
                                    <option value="ğŸ’¼" {% if settings.login_icon_1 == 'ğŸ’¼' %}selected{% endif %}>ğŸ’¼</option>
                                    <option value="ğŸ‘¥" {% if settings.login_icon_1 == 'ğŸ‘¥' %}selected{% endif %}>ğŸ‘¥</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">ÙˆÛŒÚ˜Ú¯ÛŒ Û²</label>
                            <div class="input-group">
                                <input type="text" name="login_text_2" class="form-control" value="{{ settings.login_text_2 }}" placeholder="Ù…ØªÙ† ÙˆÛŒÚ˜Ú¯ÛŒ">
                                <select name="login_icon_2" class="form-select feature-icon-select">
                                    <option value="ğŸ”" {% if settings.login_icon_2 == 'ğŸ”' %}selected{% endif %}>ğŸ”</option>
                                    <option value="ğŸ“Š" {% if settings.login_icon_2 == 'ğŸ“Š' %}selected{% endif %}>ğŸ“Š</option>
                                    <option value="ğŸ“ˆ" {% if settings.login_icon_2 == 'ğŸ“ˆ' %}selected{% endif %}>ğŸ“ˆ</option>
                                    <option value="ğŸš€" {% if settings.login_icon_2 == 'ğŸš€' %}selected{% endif %}>ğŸš€</option>
                                    <option value="ğŸ’¼" {% if settings.login_icon_2 == 'ğŸ’¼' %}selected{% endif %}>ğŸ’¼</option>
                                    <option value="ğŸ‘¥" {% if settings.login_icon_2 == 'ğŸ‘¥' %}selected{% endif %}>ğŸ‘¥</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">ÙˆÛŒÚ˜Ú¯ÛŒ Û³</label>
                            <div class="input-group">
                                <input type="text" name="login_text_3" class="form-control" value="{{ settings.login_text_3 }}" placeholder="Ù…ØªÙ† ÙˆÛŒÚ˜Ú¯ÛŒ">
                                <select name="login_icon_3" class="form-select feature-icon-select">
                                    <option value="ğŸ”" {% if settings.login_icon_3 == 'ğŸ”' %}selected{% endif %}>ğŸ”</option>
                                    <option value="ğŸ“Š" {% if settings.login_icon_3 == 'ğŸ“Š' %}selected{% endif %}>ğŸ“Š</option>
                                    <option value="ğŸ“ˆ" {% if settings.login_icon_3 == 'ğŸ“ˆ' %}selected{% endif %}>ğŸ“ˆ</option>
                                    <option value="ğŸš€" {% if settings.login_icon_3 == 'ğŸš€' %}selected{% endif %}>ğŸš€</option>
                                    <option value="ğŸ’¼" {% if settings.login_icon_3 == 'ğŸ’¼' %}selected{% endif %}>ğŸ’¼</option>
                                    <option value="ğŸ‘¥" {% if settings.login_icon_3 == 'ğŸ‘¥' %}selected{% endif %}>ğŸ‘¥</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">ğŸ“Š ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm column-settings-table">
                                            <thead>
                                                <tr>
                                                    <th width="50">Ù†Ù…Ø§ÛŒØ´</th>
                                                    <th>Ù†Ø§Ù… Ø³ØªÙˆÙ†</th>
                                                    <th width="80">ØªØ±ØªÛŒØ¨</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% set column_names = {
                                                    'row_number': 'Ø´Ù…Ø§Ø±Ù‡ Ø±Ø¯ÛŒÙ',
                                                    'avatar': 'Ø¢ÙˆØ§ØªØ§Ø±',
                                                    'id': 'ID',
                                                    'name': 'Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡',
                                                    'identifier': 'Ø´Ù†Ø§Ø³Ù‡',
                                                    'project_code': 'Ú©Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡',
                                                    'voltage_level': 'Ø³Ø·Ø­ ÙˆÙ„ØªØ§Ú˜',
                                                    'panel_type': 'Ù†ÙˆØ¹ ØªØ§Ø¨Ù„Ùˆ',
                                                    'panel_count': 'ØªØ¹Ø¯Ø§Ø¯ ØªØ§Ø¨Ù„Ùˆ',
                                                    'cell_count': 'ØªØ¹Ø¯Ø§Ø¯ Ø³Ù„ÙˆÙ„',
                                                    'department': 'Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù†',
                                                    'team_leader': 'Ù…Ø³Ø¦ÙˆÙ„ ØªÛŒÙ…',
                                                    'team': 'ØªÛŒÙ…',
                                                    'equipment_date': 'ØªØ§Ø±ÛŒØ® Ù„ÛŒØ³Øª ØªØ¬Ù‡ÛŒØ²Ø§Øª',
                                                    'urgent': 'Ù¾Ø±ÙˆÚ˜Ù‡ ÙÙˆØ±ÛŒ',
                                                    'status': 'ÙˆØ¶Ø¹ÛŒØª',
                                                    'active': 'ÙØ¹Ø§Ù„',
                                                    'public': 'Ø¯Ø³ØªØ±Ø³ÛŒ',
                                                    'created_at': 'ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯',
                                                    'updated_at': 'Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ',
                                                    'link': 'Ù„ÛŒÙ†Ú©',
                                                    'description': 'ØªÙˆØ¶ÛŒØ­Ø§Øª',
                                                    'progress_percentage': 'Ø¯Ø±ØµØ¯ Ù¾Ø±ÙˆÚ˜Ù‡ Ù‡Ø§ÛŒ Ø¯Ø± Ù…Ø³ÛŒØ±'
                                                } %}
                                                
                                                {% for column_name, display_name in column_names.items() %}
                                                {% set column_setting = column_settings.get(column_name, {'visible': True, 'order': loop.index0}) %}
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" name="column_{{ column_name }}" 
                                                               {% if column_setting.visible %}checked{% endif %} 
                                                               class="form-check-input">
                                                    </td>
                                                    <td>{{ display_name }}</td>
                                                    <td>
                                                        <input type="number" name="order_{{ column_name }}" 
                                                               value="{{ column_setting.order }}" 
                                                               class="form-control form-control-sm" 
                                                               min="0" max="100">
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    <small class="text-muted">Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯Ù‡ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</small>
                                </div>
                            </div>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø²Ù†Ø¯Ù‡
function updateColorPreview() {
    const headerColor = document.getElementById('headerColor').value;
    const headerTextColor = document.getElementById('headerTextColor').value;
    const backgroundColor = document.getElementById('backgroundColor').value;
    
    const headerPreview = document.getElementById('headerPreview');
    if (headerPreview) {
        headerPreview.style.backgroundColor = headerColor;
        headerPreview.style.color = headerTextColor;
    }
    
    const backgroundPreview = document.getElementById('backgroundPreview');
    if (backgroundPreview) {
        backgroundPreview.style.backgroundColor = backgroundColor;
    }
}

// Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
document.addEventListener('DOMContentLoaded', function() {
    updateColorPreview();
    
    const colorInputs = document.querySelectorAll('input[type="color"]');
    colorInputs.forEach(input => {
        input.addEventListener('input', updateColorPreview);
    });
});
</script>
{% endblock %}